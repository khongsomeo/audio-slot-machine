;+-----------------------------------------------------------------------------------------------+
;|                                                                                               |
;|   ____ _             __  __               ____ _           _  __  __                          |
;|  / ___| |__  _   _  |  \/  | ___  ___    / ___| |__  _   _(_) \ \/ /___   ___  _ __   __ _    |
;| | |   | '_ \| | | | | |\/| |/ _ \/ _ \  | |   | '_ \| | | | |  \  // _ \ / _ \| '_ \ / _` |   |
;| | |___| | | | |_| | | |  | |  __/ (_) | | |___| | | | |_| | |  /  \ (_) | (_) | | | | (_| |   |
;|  \____|_| |_|\__,_| |_|  |_|\___|\___/   \____|_| |_|\__,_|_| /_/\_\___/ \___/|_| |_|\__, |   |
;|                                                                                      |___/    |
;|                                                                                               |
;|> Author.........: trhgquan (https://github.com/trhgquan)                                      |
;|> ...............: meadoge (https://github.com/meadoge)                                        |
;|                                                                                               |
;+-----------------------------------------------------------------------------------------------+
;|                                                                                               |
;|                             __________████████_____██████                                     |
;|                             _________█░░░░░░░░██_██░░░░░░█                                    |
;|                             ________█░░░░░░░░░░░█░░░░░░░░░█                                   |
;|                             _______█░░░░░░░███░░░█░░░░░░░░░█                                  |
;|                             _______█░░░░███░░░███░█░░░████░█                                  |
;|                             ______█░░░██░░░░░░░░███░██░░░░██                                  |
;|                             _____█░░░░░░░░░░░░░░░░░█░░░░░░░░███                               |
;|                             ____█░░░░░░░░░░░░░██████░░░░░████░░█                              |
;|                             ____█░░░░░░░░░█████░░░████░░██░░██░░█                             |
;|                             ___██░░░░░░░███░░░░░░░░░░█░░░░░░░░███                             |
;|                             __█░░░░░░░░░░░░░░█████████░░█████████                             |
;|                             _█░░░░░░░░░░█████_████___████_█████___█                           |
;|                             _█░░░░░░░░░░█______█_███__█_____███_█___█                         |
;|                             █░░░░░░░░░░░░█___████_████____██_██████                           |
;|                             ░░░░░░░░░░░░░█████████░░░████████░░░█                             |
;|                             ░░░░░░░░░░░░░░░░█░░░░░█░░░░░░░░░░░░█                              |
;|                             ░░░░░░░░░░░░░░░░░░░░██░░░░█░░░░░░██                               |
;|                             ░░░░░░░░░░░░░░░░░░██░░░░░░░███████                                |
;|                             ░░░░░░░░░░░░░░░░██░░░░░░░░░░█░░░░░█                               |
;|                             ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                              |
;|                             ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                              |
;|                             ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                              |
;|                             ░░░░░░░░░░░█████████░░░░░░░░░░░░░░██                              |
;|                             ░░░░░░░░░░█▒▒▒▒▒▒▒▒███████████████▒▒█                             |
;|                             ░░░░░░░░░█▒▒███████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█                             |
;|                             ░░░░░░░░░█▒▒▒▒▒▒▒▒▒█████████████████                              |
;|                             ░░░░░░░░░░████████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█                             |
;|                             ░░░░░░░░░░░░░░░░░░██████████████████                              |
;|                             ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                                  |
;|                             ██░░░░░░░░░░░░░░░░░░░░░░░░░░░██                                   |
;|                             ▓██░░░░░░░░░░░░░░░░░░░░░░░░██                                     |
;|                             ▓▓▓███░░░░░░░░░░░░░░░░░░░░█                                       |
;|                             ▓▓▓▓▓▓███░░░░░░░░░░░░░░░██                                        |
;|                             ▓▓▓▓▓▓▓▓▓███████████████▓▓█                                       |
;|                             ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██                                     |
;|                             ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                                     |
;|                             ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                                    |
;|                                                                                               |
;|                                                                                               |
;|                                                                                               |
;|                        ____            _            _  __    _                                |
;|                       |  _ \ _ __ __ _(_)___  ___  | |/ /___| | __                            |
;|                       | |_) | '__/ _` | / __|/ _ \ | ' // _ \ |/ /                            |
;|                       |  __/| | | (_| | \__ \  __/ | . \  __/   <                             |
;|                       |_|   |_|  \__,_|_|___/\___| |_|\_\___|_|\_\                            |
;|                                                                                               |
;|                                                                                               |
;+-----------------------------------------------------------------------------------------------+

#include-once

; Generate the spinning number, randomly
Func generateNumber($displayArray)
  Local $arrayGenerated[3]
  For $i = 0 To UBound($arrayGenerated) - 1 Step 1
    Local $j = 0

    ; Fixed result only exist in debug mode
    If $DEBUG Then
      $arrayGenerated[$i] = $DEBUG_WIN_VALUE
    Else
      $arrayGenerated[$i] = Random($MIN_EDGE, $MAX_EDGE, 1)
    EndIf
  Next
  Return $arrayGenerated
EndFunc

; Check if triad is the same
Func isTheSame($arrayNumber)
  For $i = 0 To UBound($arrayNumber) - 2 Step 1
    if $arrayNumber[$i] <> $arrayNumber[$i + 1] Then Return False
  Next
  Return True
EndFunc

; Set colour for GUI number
Func setColourForNumbers($displayHandle, $colour)
  For $i = 0 To UBound($displayHandle) - 1 Step 1
    GUICtrlSetColor($displayHandle[$i], $colour)
  Next
EndFunc

; "Spin" button event
Func ThrowdaDice()
  setColourForNumbers($display, $COLOUR_BLACK)
  GUICtrlSetState($ThrowdaDice, $GUI_DISABLE)
  GUICtrlSetData($displayMsg, 'Spinning')

  Local $generatedArray = generateNumber($display)

  ; Calculate sum of numbers
  Local $sumSound = 0
  For $i = 0 To UBound($generatedArray) - 1 Step 1
    $sumSound += $generatedArray[$i]
  Next


  For $i = 0 To UBound($display) - 1 Step 1
    Local $j = 0

    ; Spinning effect
    while $j <= 9 * $ROLL_TIMES
      If $j > 9 Then
        GUICtrlSetData($display[$i], $j - 9)
      Else
        GUICtrlSetData($display[$i], $j)
      EndIf

      $j += 1
      Sleep(50)
    WEnd

    GUICtrlSetData($display[$i], $generatedArray[$i])
  Next

  If isTheSame($generatedArray) Then
    Local $soundVolume = percentToWin($sumSound)

    setColourForNumbers($display, $COLOUR_RED)
    GUICtrlSetData($displayMsg, 'Jackpot babe!')
    GUICtrlSetData($Audio_Progress, $soundVolume)

    ; Set volume for the computer
    _SetMasterVolume($soundVolume)
  Else
    GUICtrlSetData($displayMsg, 'No win, sorry!')
  EndIf

  GUICtrlSetState($ThrowdaDice, $GUI_ENABLE)
EndFunc

; Calculate percent spinned compare with 999
Func percentToWin($sum)
  Return Round($sum * 100 / ($MAX_EDGE * 3))
EndFunc
